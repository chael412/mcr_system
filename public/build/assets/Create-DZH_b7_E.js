import{r as n,u as R,j as a,H as P,L as T,a as p}from"./app-D5lOC2os.js";import{A as $,a as z}from"./AuthenticatedLayout-DHSc8q_9.js";import{F as i}from"./FormField-B-jj2BMM.js";import"./select-DuQksm8O.js";import{L as _}from"./label-a8Kppesc.js";import{B as g}from"./button-S9L6tSJM.js";import{I as U}from"./input-BAL8jldL.js";import{D as q,a as G,b as J,c as K,d as Q,e as V,f as W}from"./dialog-Cy7R0XOh.js";import{S as f}from"./react-select.esm-DyR3mL3e.js";import{u as X}from"./useAppUrl-Cei-Qys3.js";import"./index-eB1YD3uc.js";const ne=()=>{const x=X(),[C,F]=n.useState([]),[S,D]=n.useState([]),[u,H]=n.useState(""),[k,M]=n.useState(""),[d,m]=n.useState({firstname:"",middlename:"",lastname:"",barangay_id:""}),[c,b]=n.useState({}),{data:r,setData:t,errors:l,reset:B,processing:w}=R({firstname:"",middlename:"",lastname:"",sex:"",date_birth:"",order_birth:"",place_birth:"",father_name:"",mother_name:"",relationship_to_familyhead:"",remarks:"",register_number:"",family_head_id:u,date_of_registration:"",date_place_marriage:"",birth_certificate:""}),v=async()=>{try{const e=await p.get(`${x}/api/familyhead_options`);F(e.data)}catch(e){console.error("Error fetching authors:",e),alert("Failed to fetch authors.")}},E=async()=>{try{const e=await p.get(`${x}/api/barangay_options`);D(e.data)}catch(e){console.error("Error fetching barangays:",e),alert("Failed to fetch barangays.")}};n.useEffect(()=>{v(),E()},[]);const y=C.map(e=>({value:e.id.toString(),label:e.lastname+", "+e.firstname+" "+(e.middlename||"")})),j=S.map(e=>({value:e.id.toString(),label:e.barangay_name})),L=e=>{t("birth_certificate",e.target.files[0])},A=async e=>{var o;e.preventDefault();const s=new FormData;s.append("firstname",r.firstname),s.append("middlename",r.middlename),s.append("lastname",r.lastname),s.append("sex",r.sex),s.append("date_birth",r.date_birth),s.append("order_birth",r.order_birth),s.append("place_birth",r.place_birth),s.append("father_name",r.father_name),s.append("mother_name",r.mother_name),s.append("relationship_to_familyhead",r.relationship_to_familyhead),s.append("remarks",r.remarks),s.append("register_number",r.register_number),s.append("family_head_id",r.family_head_id),s.append("date_of_registration",r.date_of_registration),s.append("date_place_marriage",r.date_place_marriage),s.append("birth_certificate",r.birth_certificate);try{console.log("Sending Payload:",r);const h=await p.post("http://localhost:8000/api/family_register_member",s,{headers:{"Content-Type":"multipart/form-data"}});(h.status===200||h.status===201)&&(alert("Family member added successfully!"),window.location.reload(),B())}catch(h){console.error("Error saving family member:",((o=h.response)==null?void 0:o.data)||h),alert("Failed to add family member.")}},N=[{value:"M",label:"Male"},{value:"F",label:"Female"}],I=async e=>{var s;e.preventDefault(),b({}),console.log("Head Form Data:",d);try{await p.post("/api/store_familyhead",d),alert("Family head added successfully!"),v(),m({firstname:"",middlename:"",lastname:"",barangay_id:""})}catch(o){((s=o.response)==null?void 0:s.status)===422?b(o.response.data.errors):console.error(o)}};return a.jsxs($,{header:a.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Family Member"}),children:[a.jsx(P,{title:"Family Members"}),a.jsx("div",{className:" flex justify-center mb-5",children:a.jsx("div",{className:"border border-gray-400 w-[620px] rounded-md ",children:a.jsxs("form",{onSubmit:A,className:"px-6 py-4 space-y-4",children:[a.jsx("h2",{className:"text-2xl",children:"Add Family Member"}),a.jsx("hr",{}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-6 mb-1",children:[a.jsx(_,{htmlFor:"family_head",children:"Family Head"}),a.jsxs(q,{children:[a.jsx(G,{children:a.jsx(g,{variant:"secondary",size:"icon",className:"size-8",type:"button",children:a.jsx(z,{})})}),a.jsx(J,{children:a.jsxs(K,{children:[a.jsx(Q,{children:"Add Family Head"}),a.jsxs(V,{children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-2",children:[a.jsx(i,{id:"firstname",label:"First Name",value:d.firstname,onChange:e=>m({...d,firstname:e.target.value}),error:c.firstname}),a.jsx(i,{id:"middlename",label:"Middle Name",value:d.middlename,onChange:e=>m({...d,middlename:e.target.value}),error:c.middlename})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-2",children:[a.jsx(i,{id:"lastname",label:"Last Name",value:d.lastname,onChange:e=>m({...d,lastname:e.target.value}),error:c.lastname}),a.jsxs("div",{children:[a.jsx(_,{children:"Barangay"}),a.jsx(f,{options:j,value:j.find(e=>e.value===d.barangay_id),onChange:e=>m({...d,barangay_id:e.value})}),c.barangay_id&&a.jsx("p",{className:"text-red-500 text-sm",children:c.barangay_id})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[a.jsx(W,{asChild:!0,children:a.jsx(g,{variant:"outline",children:"Cancel"})}),a.jsx(g,{onClick:I,className:"px-6 py-2",children:"Save"})]})]})]})})]})]}),a.jsx("input",{type:"hidden",value:u,onChange:e=>t("family_head_id",e.target.value)}),a.jsx(f,{value:y.find(e=>e.value===u),options:y,onChange:e=>{const s=(e==null?void 0:e.value)||"";H(s),t("family_head_id",s?parseInt(s,10):null)}})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx(_,{htmlFor:"birth_certificate",children:"Birth Certificate"}),a.jsx(U,{type:"file",onChange:L})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsx(i,{id:"regsistry_number",label:"Registry Number",value:r.register_number,onChange:e=>t("register_number",e.target.value),error:l.register_number}),a.jsx(i,{id:"date_of_registration",label:"Date of Registration",type:"date",value:r.date_of_registration,onChange:e=>t("date_of_registration",e.target.value),error:l.date_of_registration})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsx(i,{id:"firstname",label:"FirstName",value:r.firstname,onChange:e=>t("firstname",e.target.value),error:l.firstname}),a.jsx(i,{id:"middlename",label:"MiddleName",value:r.middlename,onChange:e=>t("middlename",e.target.value),error:l.middlename})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsx(i,{id:"lastname",label:"LastName",value:r.lastname,onChange:e=>t("lastname",e.target.value),error:l.lastname}),a.jsxs("div",{children:[a.jsx(_,{htmlFor:"sex",children:"Sex"}),a.jsx(f,{value:N.find(e=>e.value===k),options:N,onChange:e=>{const s=(e==null?void 0:e.value)||"";M(s),t("sex",s)}})]})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsx(i,{id:"order_birth",label:"Order of Birth",value:r.order_birth,onChange:e=>t("order_birth",e.target.value),error:l.order_birth}),a.jsx(i,{id:"date_birth",label:"Date of Birth",type:"date",value:r.date_birth,onChange:e=>t("date_birth",e.target.value),error:l.date_birth})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 ",children:a.jsx(i,{id:"place_birth",label:"Place of Birth",value:r.place_birth,onChange:e=>t("place_birth",e.target.value),error:l.place_birth})}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsx(i,{id:"father_name",label:"Name of Father",value:r.father_name,onChange:e=>t("father_name",e.target.value),error:l.father_name}),a.jsx(i,{id:"mother_name",label:"Name of Mother",value:r.mother_name,onChange:e=>t("mother_name",e.target.value),error:l.mother_name})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 ",children:a.jsx(i,{id:"date_place_marriage",label:"Date & Place of Marriage",value:r.date_place_marriage,onChange:e=>t("date_place_marriage",e.target.value),error:l.date_place_marriage})}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[a.jsx(i,{id:"relationship_to_familyhead",label:"Relationship to Family Head",value:r.relationship_to_familyhead,onChange:e=>t("relationship_to_familyhead",e.target.value),error:l.relationship_to_familyhead}),a.jsx(i,{id:"remarks",label:"Remarks",value:r.remarks,onChange:e=>t("remarks",e.target.value),error:l.remarks})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[a.jsx(T,{href:"/family_members",children:a.jsx(g,{type:"button",variant:"outline",children:"Cancel"})}),a.jsx(g,{type:"submit",disabled:w,className:"px-6 py-2",children:"Save"})]})]})})})]})};export{ne as default};
